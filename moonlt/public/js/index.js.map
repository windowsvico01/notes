{"version":3,"sources":["js/index.js"],"names":["Index","userInfo","getUserInfo","data","console","log","tRoom","Room","username","uid","init","cb","Api","post","token","getCookie","res","err","indexOf","code","location","href","host","name","start","document","cookie","len","length","substring","end","unescape","rooms","createUid","tSocket","Socket","renderRoomList","bindCreateRoom","bindSelectRoom","$","find","remove","getRooms","forEach","item","append","id","_this","on","fadeIn","tName","val","createRoom","roomName","fadeOut","params","msg","tRes","socket","config","url","nameSpace","room","roomId","io","path","query","from","messageText","alertMsg","send_uid","send_name","scrollToLocation","bindLeaveRoom","bindSendMessage","getMessages","each","index","el","e","emit","show","html","hide","empty","tMessage","send_time","height","window","submit","submitMsg","preventDefault","parent","target","scrollToContainer","scrollToContainerTop","offset","top","parentTop","animate","scrollTop","tIndex"],"mappings":"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","sourcesContent":["class Index {\n  constructor() {\n    this.userInfo = {};\n  }\n  init() {\n    this.getUserInfo((data) => {\n      console.log(data);\n      const tRoom = new Room({ username: data.username, uid: data.uid });\n      tRoom.init();\n    });\n  }\n  getUserInfo(cb) {\n    Api.post('/api/getUserInfo', {token: getCookie('token')}, (res, err) => {\n      if ([-1, -2, -9].indexOf(res.code) !== -1) location.href = `${Api.host}/login.html`;\n      if (res.code === 0) cb(res.data);\n    })\n  }\n}\nconst getCookie = (name) => {\n  var start = document.cookie.indexOf(name + \"=\"); //得到cookie字符串中的名称\n  var len = start + name.length + 1; //得到从起始位置到结束cookie位置的长度\n  //如果起始没有值且name不存在于cookie字符串中，则返回null\n  if ((!start) && (name != document.cookie.substring(0, name.length))) {\n    return null;\n  }\n  if (start == -1) return null; //如果起始位置为-1也为null\n  var end = document.cookie.indexOf(';', len); //获取cookie尾部位置\n  if (end == -1) end = document.cookie.length; //计算cookie尾部长度\n  return unescape(document.cookie.substring(len, end)); //获取cookie值\n}\nclass Room {\n  constructor({ username, uid }) {\n    this.rooms = [];\n    this.uid = uid;\n    this.createUid = uid;\n    this.username = username;\n  }\n  init() {\n    const tSocket = new Socket({ username: this.username, uid: this.uid });\n    console.log(tSocket);\n    this.renderRoomList(() => {\n      tSocket.init();\n    })\n    this.bindCreateRoom(() => {\n      tSocket.bindSelectRoom();\n    })\n  }\n  renderRoomList(cb) {\n    $('#rooms').find('li').remove();\n    this.getRooms({}, (data) => {\n      if (data.length) {\n        data.forEach((item) => {\n          $('#rooms').append(`<li class=\"btn btn-warning mr-1\" data-roomid=\"${item.id}\" data-room=\"${item.name}\">${item.name}</li>`);\n        })\n        cb();\n      }\n    });\n  }\n  bindCreateRoom(cb) {\n    const _this = this;\n    $('#addRoomBtn').on('click', () => {\n      $('#addRoomModal').fadeIn();\n      $('#createRoom').on('click', () => {\n        const tName = $('#roomName').val();\n        if (!tName) return;\n        _this.createRoom({ roomName: tName, createUid: _this.createUid }, () => {\n          $('#roomName').val('');\n          $('#addRoomModal').fadeOut();\n          _this.renderRoomList(cb);\n        })\n      })\n      $('#cancelCreate').on('click', () => {\n        $('#roomName').val('');\n        $('#addRoomModal').fadeOut();\n      })\n    })\n    \n  }\n  getRooms(params, cb) {\n    Api.post('/api/getRooms', params, (res, err) => {\n      if (res.code !== 0) {\n        console.log('失败'+ err.msg);\n        return\n      }\n      cb(res.data);\n    })\n  }\n  createRoom(params, cb) {\n    const _this = this;\n    Api.post('/api/createRoom', params, (res, err) => {\n      if (res.code !== 0) {\n        console.log('失败'+ err.msg);\n        return\n      }\n      const tRes = res;\n      _this.getRooms({}, () => {\n        cb(tRes);\n      })\n    })\n  }\n}\n\nclass Socket {\n  constructor({ username, uid }) {\n    this.socket = '';\n    this.config = {\n      url: location.href,\n      nameSpace: '',\n      room: '',\n      roomId: '',\n      name: username || '',\n      uid: uid || '',\n    }\n  }\n  init() {\n    const _this = this;\n    if (!this.config.name) {\n      console.log('用户名未输入');\n      return;\n    }\n    this.socket = io({\n      path: '/test',\n      query: {\n        name: this.config.name,\n        uid: this.config.uid,\n      }\n    });\n    this.socket && this.socket.on('send_from_server', function(msg, from, roomId){\n      if (roomId) { // 发送至房间\n        let messageText = '';\n        if (!from) {\n          alertMsg(msg, 'success');\n        } else {\n          if (from.send_uid * 1 === _this.config.uid) messageText = `<div class=\"mine\"><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n          else messageText = `<div><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n        }\n        $('#messages').append(messageText);\n        scrollToLocation($('#messages'), 'div');\n      } else { // 发送至大厅\n        let messageText = '';\n        if (!from) {\n          alertMsg(msg, 'success');\n        } else {\n          if (from.send_uid * 1 === _this.config.uid) messageText = `<div class=\"mine\"><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n          else messageText = `<div><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n        }\n        $('#publicRes').append(messageText);\n        scrollToLocation($('#publicRes'), 'div');\n      }\n    });\n    this.socket && this.socket.on('error', function (data) {\n      console.log(data || 'error');\n    });\n    this.bindSelectRoom();\n    this.bindLeaveRoom();\n    this.bindSendMessage();\n    this.getMessages(100000);\n  }\n  bindSelectRoom() {\n    const _this = this;\n    $('#rooms').find('li').each(function(index, el){\n      $(el).on('click', function(e){\n        _this.config.room && _this.socket.emit('leaveRoom', _this.config.roomId);\n        _this.config.room = $(el).data('room');\n        _this.config.roomId = $(el).data('roomid');\n        $('#roomInfo').show();\n        $('#currentRoom').html(_this.config.room);\n        _this.socket.emit('joinRoom', _this.config.roomId);\n        $('#publicRes').hide();\n        $('#messages').show();\n        _this.getMessages(_this.config.roomId);\n      })\n    })\n  }\n  bindLeaveRoom() {\n    const _this = this;\n    $('#leaveBtn').on('click', () => {\n      if (!_this.config.roomId) return\n      _this.socket.emit('leaveRoom', _this.config.roomId, _this.config.uid);\n      $('#currentRoom').empty();\n      $('#roomInfo').hide();\n      $('#messages').hide();\n      $('#publicRes').show();\n      _this.getMessages(100000);\n      _this.config.room = '';\n      _this.config.roomId = '';\n    })\n  }\n  getMessages(roomId) {\n    const _this = this;\n    $('#messages').empty();\n    roomId === 100000 && $('#publicRes').find('div').remove();\n    Api.post('/api/getMessages', { roomId }, (res, err) => {\n      if (res.code === -1) {\n        console.log('获取信息失败');\n        return;\n      }\n      if (roomId === 100000) { // 大厅消息\n        res.data.length && res.data.forEach((item) => {\n          let tMessage = '';\n          if (_this.config.uid === item.send_uid) tMessage = `<div class=\"mine\"><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          else tMessage =  `<div><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          $('#publicRes').append(tMessage);\n        })\n        $('#publicRes').append(`<div class=\"public\"><span><--------↑↑ 历史消息 ↑↑-------></span></div>`);\n        $('#publicRes').height($(window).height() - 240);\n        scrollToLocation($('#publicRes'), 'div');\n      } else { // 房间消息\n        res.data.length && res.data.forEach((item) => {\n          let tMessage = '';\n          if (_this.config.uid === item.send_uid) tMessage = `<div class=\"mine\"><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          else tMessage =  `<div><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          $('#messages').append(tMessage);\n        })\n        $('#messages').append(`<div class=\"public\"><span><--------↑↑ 历史消息 ↑↑-------></span></div>`);\n        $('#messages').height($(window).height() - 240);\n        scrollToLocation($('#messages'), 'div');\n      }\n    })\n  }\n  bindSendMessage() {\n    const _this = this;\n    $('form').submit(function(e){\n      var submitMsg = $('#m').val();\n      if (!submitMsg) return;\n      e.preventDefault();\n      if (_this.config.room) _this.socket.emit('send_from_client', _this.config.room, _this.config.roomId, submitMsg);\n      else _this.socket.emit('send_from_client', '', '', submitMsg);\n      $('#m').val('');\n      return false;\n    });\n  }\n}\nconst scrollToLocation = (parent, target) => {\n  const scrollToContainer = parent.find(`${target}:last`);\n  parent.height($(window).height() - 240);\n  const scrollToContainerTop = scrollToContainer.offset() ? scrollToContainer.offset().top : 0;\n  const parentTop = parent.offset() ? parent.offset().top : 0;\n  parent.animate({\n    scrollTop: scrollToContainerTop - parentTop + parent.scrollTop()\n  }, 800);\n}\n$(function(){\n  const tIndex = new Index();\n  tIndex.init();\n})"],"file":"index.js"}
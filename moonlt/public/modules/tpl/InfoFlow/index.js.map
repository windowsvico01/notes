{"version":3,"sources":["modules/tpl/InfoFlow/index.js"],"names":["InfoFlow","dom","state","current","limit","total","category","plate","params","_ca","finalData","_this","getRootCategory","rootCategory","getCategoryList","caData","isRoot","is_root","activeCid","active_cid","activeKey","active_key","rootKey","root_key","isHome","setOuterHtml","html","left","offset","top","css","position","getMoreArticle","loadMoreDom","find","on","clicked","page","cid","getArticleData","res","err","innerHtml","list","data","outDom","remove","append","length","bindLoadMore","afterInit","cb","$","post","key","pid","console","log","setTimeout"],"mappings":"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","sourcesContent":["import index from './index.art';\nimport news from './news.art';\nimport './index.css';\nimport $ from 'jquery';\nclass InfoFlow {\n  constructor(dom) {\n    this.state = {\n      dom,\n      current: 1,\n      limit: 10,\n      total: 0,\n      category: '',\n      plate: '',\n    }\n  }\n  /**\n   * @param {object} data require { type: 'default/plate', cid, plate_id, module_id } / data {}\n   */\n  init(params = {}) {\n    const { category : _ca } = params;\n    const finalData = {};\n    const _this = this;\n    this.getRootCategory((rootCategory) => {\n      if (_ca) {  // 如果有类目key传入\n        _this.getCategoryList(_ca, (caData) => {\n          const { category, is_root: isRoot, active_cid: activeCid, active_key: activeKey, root_key: rootKey } = caData;\n          _this.state.category = activeCid;\n          finalData.activeCid = activeCid;\n          finalData.category = category;\n          finalData.isRoot = isRoot;\n          finalData.isHome = false;\n          finalData.activeKey = activeKey;\n          finalData.rootKey = rootKey;\n          finalData.rootCategory = rootCategory;\n          _this.setOuterHtml(finalData);\n        })\n      } else {\n        finalData.rootCategory = rootCategory;\n        finalData.isHome = true;\n        _this.setOuterHtml(finalData);\n      }\n    })\n  }\n  setOuterHtml(finalData) {\n    this.state.dom.html(index(finalData));\n    const left = $('#nav-box').offset().left;\n    const top = $('#nav-box').offset().top;\n    $('#nav-box').css({ position: 'fixed', top: `${top}px`, left: `${left}px` });\n    this.getMoreArticle();\n  }\n  bindLoadMore() {\n    const loadMoreDom = this.state.dom.find('#load-more');\n    const _this = this;\n    loadMoreDom.on('click', () => {\n      _this.clicked = true;\n      if (!_this.clicked) return;\n      _this.getMoreArticle();\n    })\n  }\n  getMoreArticle() {\n    const { current, limit, total, category } = this.state;\n    const params = { page: current, limit, total, cid: category };\n    const _this = this;\n    const loadMoreDom = _this.state.dom.find('#load-more');\n    this.getArticleData(params, (res, err) => {\n      const innerHtml = news({ list: res.data });\n      const outDom = _this.state.dom.find('#news-list');\n      loadMoreDom && loadMoreDom.remove();\n      outDom.append(innerHtml);\n      if (res.data && res.data.length && res.data.length == limit) { // 正常\n        outDom.append('<li id=\"load-more\"><div class=\"s-box load-more\">点击加载更多</div></li>');\n        _this.state.current += 1;\n        _this.bindLoadMore();\n      } else if (res.data && res.data.length && res.data.length < limit) { // 没有下一页\n        outDom.append('<li><div class=\"s-box no-more\">没有更多了...</div></li>');\n      } else {\n        if (current == 1) outDom.append('<li><div class=\"s-box no-more\">暂时没有内容...</div></li>');\n        else outDom.append('<li><div class=\"s-box no-more\">没有更多了...</div></li>');\n      }\n      _this.afterInit();\n    })\n  }\n  getArticleData(params, cb) {\n    $.post('/content/getDraftList', params, (res,err) => {\n      cb(res.data);\n    })\n  }\n  getCategoryList(category, cb) { // 获取类目列表\n    $.post('/content/getLevelCategory', { key: category }, (res,err) => {\n      cb(res.data);\n    })\n  }\n  getRootCategory(cb) {\n    $.post('/content/getCategory', { pid: '0' }, (res,err) => {\n      cb(res.data);\n    })\n  }\n  afterInit() {\n    console.log('init InfoFlow');\n    const _this = this;\n    setTimeout(() => {\n      _this.clicked = false;\n    }, 500)\n  }\n}\nexport default InfoFlow;"],"file":"index.js"}
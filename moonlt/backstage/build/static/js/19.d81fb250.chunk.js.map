{"version":3,"sources":["containers/Pages/Manage/Forum/List/index.js","containers/Pages/Manage/Forum/List/actions.js","containers/Pages/Manage/Forum/List/selectors.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","utils/tools.js"],"names":["List","props","_this","Object","_Users_yangpu_bt_notes_moonlt_backstage_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_1__","this","_super","call","handleUpdateCategory","editCid","state","formRef","current","validateFields","then","values","params","cid","keys","forEach","key","updateCategory","addCategory","toggleModalVisible","bool","resetFields","fieldsChange","modalVisibleToggle","handleFilesChange","timer","clearTimeout","tTimer","setTimeout","setState","handleEditCategory","fields","finalFields","push","name","value","handleAddChildCategory","pid","React","createRef","editId","loadForumList","_this2","forumList","console","log","columns","getFieldValue","title","dataIndex","render","t","react__WEBPACK_IMPORTED_MODULE_6___default","a","createElement","moment","format","record","_components_Style__WEBPACK_IMPORTED_MODULE_12__","antd__WEBPACK_IMPORTED_MODULE_10__","type","onClick","react_router_dom__WEBPACK_IMPORTED_MODULE_9__","to","concat","style","padding","className","pathname","fid","antd__WEBPACK_IMPORTED_MODULE_11__","size","dataSource","pagination","rowKey","Component","connect","selectForumList","page","selectPage","total","selectTotal","dispatch","bindActionCreators","_Users_yangpu_bt_notes_moonlt_backstage_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread2__WEBPACK_IMPORTED_MODULE_0__","actions","__webpack_require__","r","__webpack_exports__","d","LOAD_FORUMLIST","LOAD_FORUMLIST_SUCCESS","ADD","FIELDS_CHANGE","MODAL_VISIBLE_TOGGLE","UPDATE_CATEGORY","add","loadForumListSuccess","data","reselect__WEBPACK_IMPORTED_MODULE_0__","selectForumDomain","get","createSelector","subState","_defineProperties","target","i","length","descriptor","enumerable","configurable","writable","defineProperty","_createClass","Constructor","protoProps","staticProps","prototype","countNum","isNumber","str","count","re","len","test","c","charCodeAt"],"mappings":"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","file":"static/js/19.d81fb250.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { Link } from 'react-router-dom';\nimport { Table, Button, Modal, Form, Input } from 'antd';\nimport { Title, Wrapper, FloatWrapper, FormOperate} from '@/components/Style';\nimport * as actions from './actions';\nimport { selectForumList, selectTotal, selectPage } from './selectors';\nimport { countNum } from '@/utils/tools';\nimport moment from 'moment';\nclass List extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      formRef: React.createRef(),\n      timer: '',\n      editId: '',\n    };\n  }\n  componentWillMount() {\n    this.props.loadForumList({});\n  }\n  handleUpdateCategory = () => {\n    const { editCid } = this.props;\n    if (editCid) { // 编辑\n      this.state.formRef.current.validateFields().then(values => {\n        const params = { cid: editCid };\n        Object.keys(values).forEach((key) => {\n          params[key] = values[key];\n        })\n        this.props.updateCategory(params);\n      })\n    } else { // 添加\n      this.state.formRef.current.validateFields().then(values => {\n        const params = {};\n        Object.keys(values).forEach((key) => {\n          params[key] = values[key];\n        })\n        this.props.addCategory(params);\n      })\n    }\n    \n  }\n  toggleModalVisible = (bool) => {\n    if (!bool) {\n      this.state.formRef.current.resetFields();\n      this.props.fieldsChange([]); // 清空\n    }\n    this.props.modalVisibleToggle(bool);\n  }\n  handleFilesChange = (values) => {\n    if (this.state.timer) clearTimeout(this.state.timer);\n    const tTimer = setTimeout(() => {\n      this.props.fieldsChange(values);\n      this.setState({\n        timer: '',\n      })\n    }, 200)\n    this.setState({\n      timer: tTimer\n    })\n  }\n  handleEditCategory = (fields) => {\n    const finalFields = [];\n    Object.keys(fields).forEach((key) => {\n      if (key !== 'cid') {\n        finalFields.push({ name: [key], value: fields[key] });\n      }\n    })\n    this.props.fieldsChange(finalFields, fields.cid);\n    this.toggleModalVisible(true);\n  }\n  handleAddChildCategory = (pid) => {\n    const finalFields = [{ name: ['pid'], value: pid }];\n    this.props.fieldsChange(finalFields);\n    this.toggleModalVisible(true);\n  }\n  render() {\n    const { forumList } = this.props;\n    console.log(forumList);\n    const { formRef } = this.state;\n    const label = formRef && formRef.current && formRef.current.getFieldValue('label') || '';\n    const columns = [{\n      title: '板块fid',\n      dataIndex: 'fid',\n      key: 'fid',\n    }, {\n      title: '板块名称',\n      dataIndex: 'name',\n      key: 'name',\n    }, {\n      title: '所属类目',\n      dataIndex: 'category_name',\n      key: 'category_name',\n    }, {\n      title: '关注人数',\n      dataIndex: 'members',\n      key: 'members',\n    }, {\n      title: '文章总数',\n      dataIndex: 'news_count',\n      key: 'news_count',\n    }, {\n      title: '创建时间',\n      dataIndex: 'create_time',\n      key: 'create_time',\n      render: (t) => <span>{ t ? moment(t).format('YYYY-MM-DD HH:mm:ss') : '--' }</span>\n    }, {\n      title: '操作',\n      key: 'operate',\n      render: (t, record) => (\n        <FormOperate>\n          <Button type=\"link\" onClick={() => this.handleEditCategory(record)}>编辑</Button>\n          <Link to={`/manage/category/detail/${record.cid}`} style={{ padding: '4px 15px' }}>详情</Link>\n          { record.pid * 1 === 0 && <Button type=\"link\" onClick={() => this.handleAddChildCategory(record.cid)}>添加子类目</Button>}\n        </FormOperate>\n      )\n    }];\n    const layout = {\n      labelCol: { span: 6 },\n      wrapperCol: { span: 16 },\n    }; \n    return (\n      <div>\n        <Title>\n          <div className=\"borderLeft\"></div>\n          <h2>板块管理</h2>\n          <Link to={{ pathname: '/manage/forum/add', state: { fid: '123' } }}>\n            <Button type=\"primary\" className=\"btn-r\">添加板块</Button>\n          </Link>\n        </Title>\n        <Wrapper>\n          <Table columns={columns} size=\"middle\" dataSource={forumList} pagination={false} rowKey=\"cid\" />\n        </Wrapper>\n        {/* <Modal\n          title={this.props.editCid ? '编辑类目' : getTitle(fields)}\n          visible={modalVisible}\n          width={500}\n          onOk={() => this.handleUpdateCategory()}\n          onCancel={() => this.toggleModalVisible(false)}\n          okText={this.props.editCid ? '确定' : '添加'}\n          cancelText=\"取消\"\n          maskClosable={false}\n          forceRender\n        >\n          <Form\n            ref={formRef}\n            onFieldsChange={(_, all) => this.handleFilesChange(all)}\n            fields={(fields && fields.length) ? fields : []}\n            initialValues={[]}\n          >\n            <Form.Item\n              {...layout}\n              label=\"名称\"\n              name=\"name\"\n              rules={[{ required: true, message: '请输入类目名称' }]}\n            >\n              <Input addonAfter={<div style={{ width: '50px' }}>{countNum(label)}个字</div>} />\n            </Form.Item>\n            <Form.Item\n              {...layout}\n              label=\"key\"\n              name=\"path_key\"\n              rules={[{ required: true, message: '请输入唯一key值' }]}\n            >\n              <Input />\n            </Form.Item>\n            <Form.Item\n              {...layout}\n              label=\"pid\"\n              name=\"pid\"\n              style={{ display: 'none' }}\n            >\n              <Input />\n            </Form.Item>\n          </Form>\n        </Modal> */}\n      </div>\n    )\n  }\n}\nconst mapStateToProps = (state) => {\n  return {\n    forumList: selectForumList(state),\n    page: selectPage(state),\n    total: selectTotal(state),\n  };\n}\nconst mapActionsToProps = (dispatch) => bindActionCreators({ ...actions }, dispatch);\nexport default connect(mapStateToProps, mapActionsToProps)(List);\n","export const LOAD_FORUMLIST = '/Manage/Forum/List/LOAD_FORUMLIST';\nexport const LOAD_FORUMLIST_SUCCESS = '/Manage/Forum/List/LOAD_FORUMLIST_SUCCESS';\n\nexport const ADD = '/Manage/Category/List/ADD';\n\nexport const FIELDS_CHANGE = '/Manage/Category/List/FIELDS_CHANGE';\n\nexport const MODAL_VISIBLE_TOGGLE = '/Manage/Category/List/MODAL_VISIBLE_TOGGLE';\n\nexport const UPDATE_CATEGORY = '/Manage/Category/List/UPDATE_CATEGORY';\n\nexport function add(params) {\n  return {\n    type: ADD,\n    params,\n  };\n}\n\nexport function loadForumList(params) {\n  return {\n    type: LOAD_FORUMLIST,\n    params\n  };\n}\n\nexport function loadForumListSuccess(data) {\n  return {\n    type: LOAD_FORUMLIST_SUCCESS,\n    data,\n  };\n}\n\nexport function fieldsChange(fields, editCid) {\n  return {\n    type: FIELDS_CHANGE,\n    fields,\n    editCid,\n  }\n}\n\nexport function modalVisibleToggle(bool, editCid) {\n  return {\n    type: MODAL_VISIBLE_TOGGLE,\n    bool,\n    editCid,\n  }\n}\n\nexport function updateCategory(params) {\n  return {\n    type: UPDATE_CATEGORY,\n    params,\n  }\n}\n\n","import { createSelector } from 'reselect';\n// state.get 是异步的\nconst selectForumDomain = state => state.get('Manage/Forum/List');\nconst selectForumList = createSelector(\n  selectForumDomain,\n  (subState) => subState && subState.forumList,\n)\nconst selectPage = createSelector(\n  selectForumDomain,\n  (subState) => subState && subState.page,\n)\nconst selectTotal = createSelector(\n  selectForumDomain,\n  (subState) => subState && subState.total,\n)\nexport {\n  selectForumList,\n  selectPage,\n  selectTotal,\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","/**\n * @param str {string} 要计算的字符串，全角为1，半角为0.5\n */\nexport const countNum = (str) => {\n  let count = 0;\n  const re = /[\\u4e00-\\u9fa5]/;\n  const uFF61 = 0xFF61;\n  const uFF9F = 0xFF9F;\n  const uFFE8 = 0xFFE8;\n  const uFFEE = 0xFFEE;\n  if (str) {\n    for (let i = 0, len = str.length; i < len; i += 1) {\n      if (re.test(str[i])) {\n        count += 1;\n      } else {\n        const c = +str.charCodeAt(i);\n        if (c < 256) {\n          count += 0.5;\n        } else if ((uFF61 <= c) && (c <= uFF9F)) {\n          count += 0.5;\n        } else if ((uFFE8 <= c) && (c <= uFFEE)) {\n          count += 0.5;\n        } else {\n          count += 1;\n        }\n      }\n    } }\n  return count;\n}\n/**\n * @param str {string} 要分析的字符串\n */\nexport const isNumber = (str) => {\n  const regPos = /^\\d+(\\.\\d+)?$/; //非负浮点数\n  const regNeg = /^(-(([0-9]+\\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/; //负浮点数\n  if (regPos.test(str) || regNeg.test(str)) return true;\n  else return false;\n}\n"],"sourceRoot":""}
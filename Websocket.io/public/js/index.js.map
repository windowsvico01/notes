{"version":3,"sources":["js/index.js"],"names":["Index","userInfo","getUserInfo","data","tRoom","Room","username","uid","init","cb","Api","get","res","err","indexOf","code","location","href","host","rooms","createUid","tSocket","Socket","renderRoomList","bindCreateRoom","bindSelectRoom","$","find","remove","getRooms","length","forEach","item","append","id","name","_this","on","fadeIn","tName","val","createRoom","roomName","fadeOut","params","post","console","log","msg","tRes","socket","config","url","nameSpace","room","roomId","io","path","query","from","messageText","alertMsg","send_uid","send_name","scrollToLocation","bindLeaveRoom","bindSendMessage","getMessages","each","index","el","e","emit","show","html","hide","empty","tMessage","send_time","height","window","submit","submitMsg","preventDefault","parent","target","scrollToContainer","scrollToContainerTop","offset","top","parentTop","animate","scrollTop","tIndex"],"mappings":"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","sourcesContent":["class Index {\n  constructor() {\n    this.userInfo = {};\n  }\n  init() {\n    this.getUserInfo((data) => {\n      const tRoom = new Room({ username: data.username, uid: data.uid });\n      tRoom.init();\n    });\n  }\n  getUserInfo(cb) {\n    Api.get('/api/getUserInfo', (res, err) => {\n      if ([-1, -2].indexOf(res.code) !== -1) location.href = `${Api.host}/login.html`;\n      if (res.code === 0) cb(res.data);\n    })\n  }\n}\nclass Room {\n  constructor({ username, uid }) {\n    this.rooms = [];\n    this.uid = uid;\n    this.createUid = uid;\n    this.username = username;\n  }\n  init() {\n    const tSocket = new Socket({ username: this.username, uid: this.uid });\n    this.renderRoomList(() => {\n      tSocket.init();\n    })\n    this.bindCreateRoom(() => {\n      tSocket.bindSelectRoom();\n    })\n  }\n  renderRoomList(cb) {\n    $('#rooms').find('li').remove();\n    this.getRooms({}, (data) => {\n      if (data.length) {\n        data.forEach((item) => {\n          $('#rooms').append(`<li class=\"btn btn-warning mr-1\" data-roomid=\"${item.id}\" data-room=\"${item.name}\">${item.name}</li>`);\n        })\n        cb();\n      }\n    });\n  }\n  bindCreateRoom(cb) {\n    const _this = this;\n    $('#addRoomBtn').on('click', () => {\n      $('#addRoomModal').fadeIn();\n      $('#createRoom').on('click', () => {\n        const tName = $('#roomName').val();\n        if (!tName) return;\n        _this.createRoom({ roomName: tName, createUid: _this.createUid }, () => {\n          $('#roomName').val('');\n          $('#addRoomModal').fadeOut();\n          _this.renderRoomList(cb);\n        })\n      })\n      $('#cancelCreate').on('click', () => {\n        $('#roomName').val('');\n        $('#addRoomModal').fadeOut();\n      })\n    })\n    \n  }\n  getRooms(params, cb) {\n    Api.post('/api/getRooms', params, (res, err) => {\n      if (res.code !== 0) {\n        console.log('失败'+ err.msg);\n        return\n      }\n      cb(res.data);\n    })\n  }\n  createRoom(params, cb) {\n    const _this = this;\n    Api.post('/api/createRoom', params, (res, err) => {\n      if (res.code !== 0) {\n        console.log('失败'+ err.msg);\n        return\n      }\n      const tRes = res;\n      _this.getRooms({}, () => {\n        cb(tRes);\n      })\n    })\n  }\n}\n\nclass Socket {\n  constructor({ username, uid }) {\n    this.socket = '';\n    this.config = {\n      url: location.href,\n      nameSpace: '',\n      room: '',\n      roomId: '',\n      name: username || '',\n      uid: uid || '',\n    }\n  }\n  init() {\n    const _this = this;\n    if (!this.config.name) {\n      console.log('用户名未输入');\n      return;\n    }\n    this.socket = io({\n      path: '/test',\n      query: {\n        name: this.config.name,\n        uid: this.config.uid,\n      }\n    });\n    this.socket && this.socket.on('send_from_server', function(msg, from, roomId){\n      if (roomId) { // 发送至房间\n        let messageText = '';\n        if (!from) {\n          alertMsg(msg, 'success');\n        } else {\n          if (from.send_uid * 1 === _this.config.uid) messageText = `<div class=\"mine\"><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n          else messageText = `<div><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n        }\n        $('#messages').append(messageText);\n        scrollToLocation($('#messages'), 'div');\n      } else { // 发送至大厅\n        let messageText = '';\n        if (!from) {\n          alertMsg(msg, 'success');\n        } else {\n          if (from.send_uid * 1 === _this.config.uid) messageText = `<div class=\"mine\"><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n          else messageText = `<div><div class=\"header\">${from.send_name}</div><span>${msg}</span></div>`;\n        }\n        $('#publicRes').append(messageText);\n        scrollToLocation($('#publicRes'), 'div');\n      }\n    });\n    this.socket && this.socket.on('error', function (data) {\n      console.log(data || 'error');\n    });\n    this.bindSelectRoom();\n    this.bindLeaveRoom();\n    this.bindSendMessage();\n    this.getMessages(100000);\n  }\n  bindSelectRoom() {\n    const _this = this;\n    $('#rooms').find('li').each(function(index, el){\n      $(el).on('click', function(e){\n        _this.config.room && _this.socket.emit('leaveRoom', _this.config.roomId);\n        _this.config.room = $(el).data('room');\n        _this.config.roomId = $(el).data('roomid');\n        $('#roomInfo').show();\n        $('#currentRoom').html(_this.config.room);\n        _this.socket.emit('joinRoom', _this.config.roomId);\n        $('#publicRes').hide();\n        $('#messages').show();\n        _this.getMessages(_this.config.roomId);\n      })\n    })\n  }\n  bindLeaveRoom() {\n    const _this = this;\n    $('#leaveBtn').on('click', () => {\n      if (!_this.config.roomId) return\n      _this.socket.emit('leaveRoom', _this.config.roomId, _this.config.uid);\n      $('#currentRoom').empty();\n      $('#roomInfo').hide();\n      $('#messages').hide();\n      $('#publicRes').show();\n      _this.getMessages(100000);\n      _this.config.room = '';\n      _this.config.roomId = '';\n    })\n  }\n  getMessages(roomId) {\n    const _this = this;\n    $('#messages').empty();\n    roomId === 100000 && $('#publicRes').find('div').remove();\n    Api.post('/api/getMessages', { roomId }, (res, err) => {\n      if (res.code === -1) {\n        console.log('获取信息失败');\n        return;\n      }\n      if (roomId === 100000) { // 大厅消息\n        res.data.length && res.data.forEach((item) => {\n          let tMessage = '';\n          if (_this.config.uid === item.send_uid) tMessage = `<div class=\"mine\"><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          else tMessage =  `<div><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          $('#publicRes').append(tMessage);\n        })\n        $('#publicRes').append(`<div class=\"public\"><span><--------↑↑ 历史消息 ↑↑-------></span></div>`);\n        $('#publicRes').height($(window).height() - 240);\n        scrollToLocation($('#publicRes'), 'div');\n      } else { // 房间消息\n        res.data.length && res.data.forEach((item) => {\n          let tMessage = '';\n          if (_this.config.uid === item.send_uid) tMessage = `<div class=\"mine\"><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          else tMessage =  `<div><div class=\"header\">${item.send_name}</div><span>${item.msg}( ${item.send_time} )</span></div>`;\n          $('#messages').append(tMessage);\n        })\n        $('#messages').append(`<div class=\"public\"><span><--------↑↑ 历史消息 ↑↑-------></span></div>`);\n        $('#messages').height($(window).height() - 240);\n        scrollToLocation($('#messages'), 'div');\n      }\n    })\n  }\n  bindSendMessage() {\n    const _this = this;\n    $('form').submit(function(e){\n      var submitMsg = $('#m').val();\n      if (!submitMsg) return;\n      e.preventDefault();\n      if (_this.config.room) _this.socket.emit('send_from_client', _this.config.room, _this.config.roomId, submitMsg);\n      else _this.socket.emit('send_from_client', '', '', submitMsg);\n      $('#m').val('');\n      return false;\n    });\n  }\n}\nconst scrollToLocation = (parent, target) => {\n  const scrollToContainer = parent.find(`${target}:last`);\n  parent.height($(window).height() - 240);\n  const scrollToContainerTop = scrollToContainer.offset() ? scrollToContainer.offset().top : 0;\n  const parentTop = parent.offset() ? parent.offset().top : 0;\n  parent.animate({\n    scrollTop: scrollToContainerTop - parentTop + parent.scrollTop()\n  }, 800);\n}\n$(function(){\n  const tIndex = new Index();\n  tIndex.init();\n})"],"file":"index.js"}